<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>app-router</title>
    <script src="/bower_components/webcomponentsjs/webcomponents.js" debug></script>
    <link rel="import" href="/bower_components/polymer/polymer.html">
    <link rel="import" href="/src/app-router.html">
  </head>
  <body>

   <div style="border: 1px solid grey;">
      <h3>Polymer 1.0 Failed</h3>
      <ul>
        <li>data binding to templates does not work anymore (Polymer's template.createInstance removed)</li>
        <li><code>router.templateInstance.model</code> does not exists anymore</li>
      </ul>
    </div>
    <p>Test the different <code>app-route</code> types by navigating through these links.</p>
    <ul>
      <li><a href="#/template-binding/1234/route%20args!">/template-binding/1234/route%20args!</a></li>
      <li><a href="#/custom-element-binding/1234/route%20args!">/custom-element-binding/1234/route%20args!</a></li>
      <li><a href="#/before-data-binding-event">/before-data-binding-event</a></li>
      <li><a href="#/no-router-binding">/no-router-binding</a></li>
    </ul>

    <p>Data binding to templates, testing <code>bindRouter</code>, and <code>bindRouter</code> to get the parent template with <code>router.templateInstance.model</code> bindings.</p>

    <dom-module id="test-binding-page">
      <template>
        <h2>parent published attribute - <span>{{router.templateInstance.model.first}}</span></h2>
        <h2>route arg bound to custom element - <span>{{second}}</span></h2>
        <h2>route arg bound to custom element - <span>{{third}}</span></h2>
        <h2>parent property (not published) - <span>{{router.templateInstance.model.fourth}}</span></h2>
      </template>
    </dom-module>
    <script>
      Polymer({
        is: 'test-binding-page',
        properties: {
          second: Number,
          third: Number,
          router: Object
        },
        attached: function() {
          // dynamic data binding should update the parent's template too
          // TODO(plequang): no working anymer
          this.router.templateInstance.model.first = 'updated 1st arg!';
        }
      });
    </script>

    <dom-module id="router-binding-example">
      <template>
        <!-- dynamic data binding should update the parent's template when the child sets router.templateInstance.model.first -->
        <p>In the parent template, first arg <span>{{first}}</span></p>
        <app-router>
          <app-route path="/custom-element-binding/:second/:third" element="test-binding-page" bindRouter></app-route>
          <app-route path="/template-binding/:second/:third" bindRouter>
            <template>
              <h2>parent published attribute - <span>{{router.templateInstance.model.first}}</span></h2>
              <h2>route arg bound to template - <span>{{second}}</span></h2>
              <h2>route arg bound to template - <span>{{third}}</span></h2>
              <h2>parent property (not published) - <span>{{router.templateInstance.model.fourth}}</span></h2>
            </template>
          </app-route>
          <app-route path="/no-router-binding">
            <template>
              <h2>Parent bindings shouldn't be available in this case.</h2>
              <h2>parent published attribute - <span>{{router.templateInstance.model.first}}</span></h2>
              <h2>parent property (not published) - <span>{{router.templateInstance.model.fourth}}</span></h2>
            </template>
          </app-route>
          <app-route path="/before-data-binding-event" on-before-data-binding="updateRouteModel">
            <template>
              <h2>Property bound using <code>before-data-binding</code> event - <span>{{newProperty}}</span></h2>
            </template>
          </app-route>
          <app-route path="*">
            <template>
              <h2>Not Found</h2>
            </template>
          </app-route>
        </app-router>
      </template>
    </dom-module>
    <script>
      Polymer({
        is: 'router-binding-example',
        properties: {
          first: {
            type: Number,
            observer: 'firstChanged'
          }
        },
        ready: function() {
          this.fourth = '4th arg!';
        },
        firstChanged: function(oldFirst, newFirst) {
          console.log('parent {{first}} updated: ' + newFirst);
        },
        updateRouteModel: function(event) {
          console.log('updateRouteModel', event);
          event.detail.model.newProperty = 'modified model';
        }
      });
    </script>

    <router-binding-example first="1st arg!"></router-binding-example>

  </body>
</html>
